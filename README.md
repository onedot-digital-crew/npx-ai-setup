# @onedot/ai-setup

AI infrastructure for projects: Claude Code, Hooks, Project Context, AI-curated Skills.
One command creates the complete setup, then Claude analyzes the code and populates everything automatically.

## Installation

```bash
npx github:onedot-digital-crew/npx-ai-setup
```

**With specific system/framework:**

```bash
# Single system
npx github:onedot-digital-crew/npx-ai-setup --system nuxt

# Multiple systems (comma-separated)
npx github:onedot-digital-crew/npx-ai-setup --system nuxt,storyblok

# Available: auto, shopify, nuxt, next, laravel, shopware, storyblok
```

During interactive setup, use **Space** to toggle multiple selections (e.g., Nuxt + Storyblok).

**With GSD workflow engine (optional):**

```bash
npx github:onedot-digital-crew/npx-ai-setup --with-gsd
```

**With Claude-Mem persistent memory (optional):**

```bash
npx github:onedot-digital-crew/npx-ai-setup --with-claude-mem
```

**With official Claude Code plugins (optional):**

```bash
npx github:onedot-digital-crew/npx-ai-setup --with-plugins
```

**With Context7 MCP server (optional):**

```bash
npx github:onedot-digital-crew/npx-ai-setup --with-context7
```

**With Playwright MCP for UI verification (optional):**

```bash
npx github:onedot-digital-crew/npx-ai-setup --with-playwright
```

**Skip optional features:**

```bash
npx github:onedot-digital-crew/npx-ai-setup --no-plugins --no-context7 --no-playwright
```

## Update

Just run the same command again:

```bash
npx github:onedot-digital-crew/npx-ai-setup
```

The script automatically detects what to do:

| Situation | What happens |
|---|---|
| **Fresh install** (no `.ai-setup.json`) | Normal installation |
| **Same version** | "Already up to date" + optional regenerate |
| **New version available** | Offers: **Update** / **Clean reinstall** / **Skip** |

**Update** compares each template file:
- Unmodified files are updated silently
- User-modified files are backed up to `.ai-setup-backup/` before updating
- New files (added in newer version) are installed automatically

**Clean reinstall** removes all managed files and runs a fresh install.

## Requirements

- **Node.js** >= 18
- **npm** (for `npx`)
- **jq** (for hooks, JSON parsing) - `brew install jq`
- **Claude Code CLI** (`claude`) - for Auto-Init (optional, Copilot as fallback)

## Architecture

```
.agents/context/              = Project context (auto-generated by Auto-Init)
CLAUDE.md                      = Rules (Communication Protocol, Commands, Critical Rules)
.claude/hooks/                 = Safety hooks (protect, lint, circuit-breaker)
```

---

## What it does

### 1. Project scaffolding (instant)

- Copies `CLAUDE.md` with communication protocol, project documentation references, task complexity routing (simple/medium/complex with model guidance), and dual-condition verification gate
- Sets up `.claude/settings.json` with granular bash permissions (no `Bash(*)`)
- Installs 6 hooks: auto-lint on edit, file protection (.env, package-lock.json), circuit breaker, context freshness check, update-check, cross-platform notifications
- Adds `.github/copilot-instructions.md` for GitHub Copilot context
- Cleans up legacy AI structures (.ai/, .skillkit/, old skills)

### 2. Slash Commands (16 commands)

| Command | Model | Description |
|---------|-------|-------------|
| `/spec "task"` | Opus (plan mode) | Challenge idea first (GO/SIMPLIFY/REJECT), then create structured spec |
| `/spec-work 001` | Sonnet 4.6 | Execute a spec step by step (`draft` → `in-progress` → `in-review`) |
| `/spec-work-all` | Sonnet 4.6 | Execute all draft specs in parallel via Git worktrees (isolated branches) |
| `/spec-review 001` | Opus (plan mode) | Review spec changes against acceptance criteria, draft PR on approval |
| `/spec-board` | Sonnet (plan mode) | Kanban-style overview of all specs with status + step progress |
| `/release` | Sonnet 4.6 | Bump version, format CHANGELOG under version heading, commit + git tag |
| `/commit` | Sonnet 4.6 | Stage changes + create descriptive commit (no push) |
| `/pr` | Sonnet 4.6 | Prepare a PR — drafts title/body, you push and create manually |
| `/review` | Opus (plan mode) | Review uncommitted changes — bugs, security, performance |
| `/test` | Sonnet 4.6 | Run tests + fix failures (up to 3 attempts) |
| `/techdebt` | Sonnet 4.6 | End-of-session sweep — dead code, unused imports, duplicates |
| `/bug "description"` | Sonnet 4.6 | Structured bug investigation: reproduce → root cause → fix → verify |
| `/grill` | Opus (plan mode) | Adversarial code review — blocks until all issues resolved |
| `/analyze` | Sonnet 4.6 | 3 parallel agents — architecture overview, hotspots, risks |
| `/context-full` | Sonnet 4.6 | Full codebase snapshot via repomix for context loading |
| `/reflect` | Sonnet 4.6 | Detect session corrections + write them as permanent CLAUDE.md rules |

### 3. Subagent Templates (8 agents)

Subagents run as isolated agents for parallel or specialized work:

| Agent | Model | Purpose |
|-------|-------|---------|
| `verify-app` | Sonnet 4.6 | Validate functionality — tests, build, edge cases |
| `build-validator` | Haiku | Quick build verification — pass/fail with output |
| `staff-reviewer` | Opus (plan mode) | Skeptical staff engineer review of plans/implementations |
| `context-refresher` | Sonnet 4.6 | Regenerate `.agents/context/` on `[CONTEXT STALE]` signal |
| `code-reviewer` | Sonnet 4.6 | Code review with HIGH/MEDIUM confidence — PASS/CONCERNS/FAIL verdict |
| `code-architect` | Opus (plan mode) | Architectural assessment before implementation — PROCEED/REDESIGN verdict |
| `perf-reviewer` | Sonnet 4.6 | Performance review — FAST/CONCERNS/SLOW verdict |
| `test-generator` | Sonnet 4.6 | Generates missing tests for recently changed files |

### 4. Spec-driven workflow

Scaffolds a `specs/` directory with a Kanban-style lifecycle:

```
/spec "feature"        → draft (Backlog)
/spec-board            → Kanban overview with step progress
/spec-work NNN         → draft → in-progress → in-review
/spec-work-all         → Parallel execution via Git worktrees (one branch per spec)
/spec-review NNN       → Review against acceptance criteria → completed + PR draft
```

**Status lifecycle:** `draft` → `in-progress` → `in-review` → `completed` (or `blocked` at any stage)

**Parallel execution** uses isolated Git worktrees — each spec gets its own branch (`spec/NNN-title`), agents work in parallel without merge conflicts. After completion, each spec is ready for `/spec-review`.

**Hybrid automation**: Claude suggests creating a spec when a task touches 3+ files or involves new features. Simple fixes skip specs entirely.

### 3. Auto-Init (optional, requires Claude CLI)

Runs 3 steps after scaffolding (Steps 1+2 run in parallel):

| Step                | What                                                                                      | Details                 |
| ------------------- | ----------------------------------------------------------------------------------------- | ----------------------- |
| **CLAUDE.md**       | Claude adds `## Commands` (from package.json) + `## Critical Rules` (from linting config) | Sonnet, max 3 turns     |
| **Project Context** | Generates `.agents/context/` with STACK.md, ARCHITECTURE.md, CONVENTIONS.md               | Sonnet, max 4 turns     |
| **Skills**          | AI-curated skill installation + system-specific default skills                            | Haiku (ranking), 1 turn |

### 4. Project Context Generation

During Auto-Init, Claude analyzes the codebase and generates 3 context files in `.agents/context/`:

| File                | Contents                                                                             |
| ------------------- | ------------------------------------------------------------------------------------ |
| **STACK.md**        | Runtime, framework, key dependencies, package manager, build tools                   |
| **ARCHITECTURE.md** | Project type, directory structure, entry points, data flow, key patterns             |
| **CONVENTIONS.md**  | Naming patterns, import style, component structure, error handling, TypeScript usage |

These files are referenced by both `CLAUDE.md` and `.github/copilot-instructions.md`, giving AI assistants instant project understanding.

**Regenerate later:**

```bash
npx github:onedot-digital-crew/npx-ai-setup --regenerate
```

Or just run `npx @onedot/ai-setup` again — if already up to date, you'll get an interactive selector to choose what to regenerate:

```
  Select what to regenerate:
  (Use ↑↓ arrows, Space to toggle, Enter to confirm)

  ▸ [✓] CLAUDE.md     Commands & Critical Rules
    [✓] Context       .agents/context/ (STACK, ARCHITECTURE, CONVENTIONS)
    [✓] Commands      Slash commands & agents (spec, commit, grill...)
    [✓] Skills        External skills from skills.sh
```

### 5. AI-curated Skills installation

Reads `package.json`, searches [skills.sh](https://skills.sh) for matching skills, fetches install counts, and uses Claude Haiku to select the top 5 most relevant. All skill IDs are pre-validated — invalid skills are skipped with a warning. Fallback: top 3 per technology if Claude is unavailable.

Supported: Vue, Nuxt, React, Next.js, Svelte, Astro, Tailwind, TypeScript, Express, NestJS, Shopify, Angular, Prisma, Drizzle, Supabase, Firebase, Vitest, Playwright, Pinia, TanStack, Zustand and more.

**System-specific defaults** (always installed):

| System | Skills |
|--------|--------|
| **Shopify** | `sickn33/antigravity-awesome-skills@shopify-development`, `jeffallan/claude-skills@shopify-expert`, `henkisdabro/wookstar-claude-code-plugins@shopify-theme-dev` |
| **Nuxt 4 / Vue** | `antfu/skills@nuxt`, `onmax/nuxt-skills@nuxt`, `onmax/nuxt-skills@vue`, `onmax/nuxt-skills@vueuse` |
| **Next.js / React** | `vercel-labs/agent-skills@vercel-react-best-practices`, `jeffallan/claude-skills@nextjs-developer`, `wshobson/agents@nextjs-app-router-patterns` |
| **Laravel** | `jeffallan/claude-skills@laravel-specialist`, `iserter/laravel-claude-agents@eloquent-best-practices` |
| **Shopware** | `bartundmett/skills@shopware6-best-practices` |
| **Storyblok** | `bartundmett/skills@storyblok-best-practices` |


### 6. Hooks (active after setup)

| Hook                      | Trigger           | What it does                                                              |
| ------------------------- | ----------------- | ------------------------------------------------------------------------- |
| **protect-files.sh**      | Before Edit/Write | Blocks changes to `.env`, `package-lock.json`, `.git/`                    |
| **post-edit-lint.sh**     | After Edit/Write  | Auto-runs `eslint --fix` on .js/.ts/.jsx/.tsx, Prettier on other web files |
| **circuit-breaker.sh**    | Before Edit/Write | Warns at 5x edits, blocks at 8x edits to same file within 10 min         |
| **context-freshness.sh**  | UserPromptSubmit  | Warns when `.agents/context/` may be outdated; triggers context-refresher  |
| **update-check.sh**       | UserPromptSubmit  | Notifies when a new ai-setup version is available; resets circuit breaker  |
| **notify.sh**             | Notification      | Cross-platform notifications (macOS/Linux) for Claude Code events          |

### 7. Permissions

Granular bash permissions instead of `Bash(*)`:

- **Allowed**: `git add/commit/status/log/diff/tag/branch/checkout/stash`, `npm run/test/install`, `eslint`, `prettier`, `vitest`, `playwright`, `gh pr/issue`, `jq`, `curl`, `cat/ls/grep/...`
- **Denied**: `git push`, `git reset --hard`, `git clean`, `git checkout --`, `git restore`, `rm -r`, `rm -rf`, `npm publish`, reading `.env`

For maximum autonomy: `claude --dangerously-skip-permissions`

---

## File Structure

```
project/
+-- .agents/
|   +-- context/                 # Created by Auto-Init
|       +-- STACK.md             # Technology stack
|       +-- ARCHITECTURE.md      # Project architecture
|       +-- CONVENTIONS.md       # Coding conventions
+-- .claude/
|   +-- settings.json            # Permissions + Hooks + Plugin config
|   +-- commands/                # Slash commands (15)
|   |   +-- spec.md              # /spec — create specs (Opus)
|   |   +-- spec-work.md         # /spec-work — execute specs (Sonnet)
|   |   +-- spec-work-all.md     # /spec-work-all — parallel execute via Git worktrees
|   |   +-- spec-review.md       # /spec-review — review + PR draft (Opus)
|   |   +-- spec-board.md        # /spec-board — Kanban overview (Sonnet)
|   |   +-- release.md           # /release — bump version + git tag
|   |   +-- commit.md            # /commit — stage + commit
|   |   +-- pr.md                # /pr — prepare PR
|   |   +-- review.md            # /review — code review (Opus)
|   |   +-- test.md              # /test — run + fix tests
|   |   +-- techdebt.md          # /techdebt — debt sweep
|   |   +-- bug.md               # /bug — bug investigation (Sonnet)
|   |   +-- grill.md             # /grill — adversarial review (Opus)
|   |   +-- analyze.md           # /analyze — parallel codebase overview
|   |   +-- context-full.md      # /context-full — repomix snapshot
|   +-- agents/                  # Subagent templates (8)
|   |   +-- verify-app.md        # App functionality validation
|   |   +-- build-validator.md   # Build success check
|   |   +-- staff-reviewer.md    # Skeptical staff engineer
|   |   +-- context-refresher.md # Regenerates .agents/context/ on [CONTEXT STALE]
|   |   +-- code-reviewer.md     # Code review — PASS/CONCERNS/FAIL
|   |   +-- code-architect.md    # Architectural assessment — PROCEED/REDESIGN
|   |   +-- perf-reviewer.md     # Performance review — FAST/CONCERNS/SLOW
|   |   +-- test-generator.md    # Generates missing tests
|   +-- hooks/
|       +-- protect-files.sh     # Protects .env, package-lock.json, .git/
|       +-- post-edit-lint.sh    # ESLint + Prettier after Edit
|       +-- circuit-breaker.sh   # Detects edit loops
|       +-- context-freshness.sh # Stale context warning
|       +-- update-check.sh      # ai-setup version update notification
|       +-- notify.sh            # Cross-platform notifications
+-- .github/
|   +-- copilot-instructions.md
+-- specs/                         # Spec-driven development
|   +-- TEMPLATE.md              # Spec template
|   +-- README.md                # Workflow guide
|   +-- completed/               # Archive for finished specs
+-- .mcp.json                    # MCP server config (Context7, Playwright)
+-- CLAUDE.md                    # AI Rules + Critical Rules
```

---

## Security

| Protected           | Why                  |
| ------------------- | -------------------- |
| `.env`              | Secrets              |
| `package-lock.json` | Dependency Integrity |
| `.git/`             | Repository History   |

---

## Skills

### Search and install manually

```bash
npx skills find <technology>
npx skills add <owner/repo@skill> --agent claude-code --agent github-copilot -y
```

### Create custom skills

Skills live in `.claude/skills/<name>/` with a `prompt.md`:

```bash
mkdir -p .claude/skills/my-skill
```

`.claude/skills/my-skill/prompt.md`:

```markdown
# My Skill

Description of what this skill does.

## Rules

- Rule 1
- Rule 2
```

Invoke in Claude Code: `/my-skill`

---

## FAQ

**Where is the project context documentation?**
Auto-Init generates 3 context files in `.agents/context/` (STACK.md, ARCHITECTURE.md, CONVENTIONS.md). These are referenced by CLAUDE.md and copilot-instructions.md.

**Can I regenerate the context files?**
Yes: `npx github:onedot-digital-crew/npx-ai-setup --regenerate` — runs Claude Sonnet to re-analyze the codebase and update CLAUDE.md + all 3 context files + skills.

**Claude CLI vs. Copilot CLI?**
The script automatically detects which AI CLI is installed. Claude gets Auto-Init (context generation + skill curation), Copilot gets manual instructions.

**What about GSD?**
GSD is an optional workflow engine for structured AI development. Install it with `--with-gsd` flag or choose it during interactive setup. See the section below.

---

## Plugins & Extensions

The setup installs plugins via 3 mechanisms:

| Plugin              | Type        | Install Mechanism                           | Slash Command  |
| ------------------- | ----------- | ------------------------------------------- | -------------- |
| **claude-mem**      | Marketplace | `extraKnownMarketplaces` in settings.json   | automatic      |
| **code-review**     | Official    | `claude plugin install` / `/plugin install` | `/code-review` |
| **feature-dev**     | Official    | `claude plugin install` / `/plugin install` | `/feature-dev` |
| **ralph-wiggum**    | Official    | `claude plugin install` / `/plugin install` | `/ralph-loop`  |
| **frontend-design** | Official    | `claude plugin install` / `/plugin install` | — (skill)      |
| **Context7**        | MCP Server  | `.mcp.json`                                 | "use context7" |

### Claude-Mem (Persistent Memory)

[Claude-Mem](https://claude-mem.ai) captures tool usage, generates semantic summaries, and injects relevant context into future sessions.

```bash
npx github:onedot-digital-crew/npx-ai-setup --with-claude-mem

# Or manually in Claude Code:
/plugin marketplace add thedotmack/claude-mem
/plugin install claude-mem
```

- **Persistent Memory** — Context survives across sessions
- **Progressive Disclosure** — Layered memory retrieval, token-efficient
- **MCP Search Tools** — Query project history with natural language
- **Web Viewer** — Real-time memory stream at http://localhost:37777

### Official Plugins

```bash
npx github:onedot-digital-crew/npx-ai-setup --with-plugins
```

| Plugin              | What it does                                                                 |
| ------------------- | ---------------------------------------------------------------------------- |
| **code-review**     | 4 parallel review agents with confidence scoring. `/code-review [--comment]` |
| **feature-dev**     | 7-phase feature workflow: discovery → architecture → review. `/feature-dev`  |
| **ralph-wiggum**    | Iterative loop — Claude keeps working until task is done. `/ralph-loop`      |
| **frontend-design** | Anti-generic design guidance for frontend projects                           |

During interactive setup, you select which plugins to install (numbers, "all", or "none").

### Context7 (MCP Server)

[Context7](https://github.com/upstash/context7) fetches up-to-date library docs directly into Claude's context (45k+ ⭐).

```bash
npx github:onedot-digital-crew/npx-ai-setup --with-context7
```

Creates `.mcp.json` in project root:

```json
{
  "mcpServers": {
    "context7": {
      "command": "npx",
      "args": ["-y", "@upstash/context7-mcp"]
    }
  }
}
```

Usage: Add "use context7" to any prompt for current library docs.

### Playwright MCP (Browser Automation)

[Playwright MCP](https://github.com/anthropics/mcp-playwright) enables Claude to interact with web browsers for UI verification — taking screenshots, clicking elements, and validating frontend behavior.

```bash
npx github:onedot-digital-crew/npx-ai-setup --with-playwright
```

Adds to `.mcp.json`:

```json
{
  "mcpServers": {
    "playwright": {
      "command": "npx",
      "args": ["-y", "@anthropic-ai/mcp-playwright"]
    }
  }
}
```

### How plugins are shared with the team

- **Marketplace plugins**: `extraKnownMarketplaces` + `enabledPlugins` in `.claude/settings.json` (committed to git) — teammates get prompted to install on first trust
- **Official plugins**: Installed per-project via `--scope project`, config in `.claude/settings.json`
- **MCP servers**: `.mcp.json` in project root (committed to git) — automatically available to all team members

---

## Optional: GSD Workflow

[GSD (Get Shit Done)](https://github.com/get-shit-done-cc/get-shit-done-cc) is a workflow engine for structured AI development. It adds phase planning, codebase mapping, session management, and file-based state.

```bash
# During ai-setup
npx github:onedot-digital-crew/npx-ai-setup --with-gsd

# Or install GSD separately
npx get-shit-done-cc@latest --claude --global
```

### Commands

```
/gsd:new-project          Initialize project, tech stack, and roadmap
/gsd:discuss-phase N      Clarify requirements before planning
/gsd:plan-phase N         Create step-by-step plan
/gsd:execute-phase N      Write code & commit atomically
/gsd:verify-work N        User acceptance testing
/gsd:quick "task"         Fast fix (typos, CSS, config)
/gsd:debug                Systematic debugging
/gsd:pause-work           Save context for later
/gsd:resume-work          Restore previous session
/gsd:progress             Status & next action
/gsd:add-phase            Add phase to roadmap
/gsd:insert-phase         Insert urgent work (e.g. 3.1)
/gsd:add-todo             Capture idea as todo
/gsd:check-todos          Show open todos
```

---

## Documentation

- [Concept](docs/CONCEPT.md) — Why this project exists, design philosophy, key ideas
- [Architecture](docs/ARCHITECTURE.md) — How the system works end-to-end (setup flow, Auto-Init, hooks, skill curation)
- [Design Decisions](docs/DESIGN-DECISIONS.md) — Key technical decisions with rationale

---

## Recommended Tools

Tools that complement this setup but are installed independently:

- [ccusage](https://github.com/ryoppippi/ccusage) — Analyze Claude Code token usage and costs from local session files. Run `npx ccusage` to see daily/monthly breakdowns, billing windows, and per-model cost analysis.

---

## Links

- [Skills — Browse & Install](https://skills.sh/)
- [Claude-Mem — Persistent Memory](https://claude-mem.ai)
- [GSD (Get Shit Done)](https://github.com/get-shit-done-cc/get-shit-done-cc)
- [Context7 — Up-to-date Library Docs](https://github.com/upstash/context7)
- [Code-Review Plugin](https://github.com/anthropics/claude-code-plugins/tree/main/code-review)
- [Feature-Dev Plugin](https://github.com/anthropics/claude-code-plugins/tree/main/feature-dev)
- [Ralph-Wiggum Plugin](https://github.com/anthropics/claude-code-plugins/tree/main/ralph-wiggum)
- [Frontend-Design Plugin](https://github.com/anthropics/claude-code-plugins/tree/main/frontend-design)
- [Claude Code Docs](https://docs.anthropic.com/en/docs/claude-code)
- [Claude Code Hooks](https://docs.anthropic.com/en/docs/claude-code/hooks)
- [CLAUDE.md Best Practices](https://docs.anthropic.com/en/docs/claude-code/memory)

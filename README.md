# @onedot/ai-setup

AI infrastructure for projects: Claude Code, Hooks, Project Context, AI-curated Skills.
One command creates the complete setup, then Claude analyzes the code and populates everything automatically.

## Installation

```bash
npx github:onedot-digital-crew/npx-ai-setup
```

**With GSD workflow engine (optional):**

```bash
npx github:onedot-digital-crew/npx-ai-setup --with-gsd
```

## Requirements

- **Node.js** >= 18
- **npm** (for `npx`)
- **jq** (for hooks, JSON parsing) - `brew install jq`
- **Claude Code CLI** (`claude`) - for Auto-Init (optional, Copilot as fallback)

## Architecture

```
.agents/context/              = Project context (auto-generated by Auto-Init)
CLAUDE.md                      = Rules (Communication Protocol, Commands, Critical Rules)
.claude/hooks/                 = Safety hooks (protect, lint, circuit-breaker)
```

---

## What it does

### 1. Project scaffolding (instant)

- Copies `CLAUDE.md` with communication protocol and project documentation references
- Sets up `.claude/settings.json` with granular bash permissions (no `Bash(*)`)
- Installs hooks: auto-lint on edit, file protection (.env, package-lock.json), circuit breaker (detects edit loops)
- Adds `.github/copilot-instructions.md` for GitHub Copilot context
- Cleans up legacy AI structures (.ai/, .skillkit/, old skills)

### 2. Auto-Init (optional, requires Claude CLI)

Runs 3 steps after scaffolding (Steps 1+2 run in parallel):

| Step | What | Details |
|------|------|---------|
| **CLAUDE.md** | Claude adds `## Commands` (from package.json) + `## Critical Rules` (from linting config) | Sonnet, max 3 turns |
| **Project Context** | Generates `.agents/context/` with STACK.md, ARCHITECTURE.md, CONVENTIONS.md | Haiku, max 5 turns |
| **Skills** | AI-curated skill installation with live progress (see below) | Sonnet, 1 turn |

### 3. Project Context Generation

During Auto-Init, Claude analyzes the codebase and generates 3 context files in `.agents/context/`:

| File | Contents |
|------|----------|
| **STACK.md** | Runtime, framework, key dependencies, package manager, build tools |
| **ARCHITECTURE.md** | Project type, directory structure, entry points, data flow, key patterns |
| **CONVENTIONS.md** | Naming patterns, import style, component structure, error handling, TypeScript usage |

These files are referenced by both `CLAUDE.md` and `.github/copilot-instructions.md`, giving AI assistants instant project understanding.

**Regenerate later:**
```bash
.agents/regenerate.sh
```

### 4. AI-curated Skills installation

Skills are automatically detected, curated, and installed in 4 phases:

**Phase 1 — Detect & Search** (bash, 30s timeout per search)
Reads `package.json` dependencies, maps them to technology keywords, and searches for available skills.

Supported technologies: Vue, Nuxt, Nuxt UI, React, Next.js, Svelte, Astro, Tailwind, Shadcn, Radix, Headless UI, TypeScript, Express, NestJS, Hono, Shopify, Angular, Prisma, Drizzle, Supabase, Firebase, Vitest, Playwright, Pinia, TanStack, Zustand

**Phase 2 — Fetch Install Counts** (parallel curl, ~1s)
Fetches weekly install counts from [skills.sh](https://skills.sh) for all found skills in parallel.

**Phase 3 — AI Curation** (Claude Sonnet, 1 turn, 60s timeout)
Claude selects the top 5 most relevant skills based on install counts, maintainer reputation, and tech stack fit.

**Phase 4 — Install** (bash, live output)
Selected skills are installed with live status updates.

**Fallback**: If Claude is unavailable or times out, top 3 per technology are installed without AI curation.

### 5. Hooks (active after setup)

| Hook | Trigger | What it does |
|------|---------|-------------|
| **protect-files.sh** | Before Edit/Write | Blocks changes to `.env`, `package-lock.json`, `.git/` |
| **post-edit-lint.sh** | After Edit/Write | Auto-runs `eslint --fix` on .js/.ts files |
| **circuit-breaker.sh** | Before Edit/Write | Warns at 5x edits, blocks at 8x edits to same file within 10 min |

### 6. Permissions

Granular bash permissions instead of `Bash(*)`:
- **Allowed**: `git add/commit/status/log/diff/tag`, `npm run`, `eslint`, `cat/ls/grep/...`
- **Denied**: `git push`, `rm -rf`, reading `.env`

For maximum autonomy: `claude --dangerously-skip-permissions`

---

## File Structure

```
project/
+-- .agents/
|   +-- regenerate.sh            # Regenerate context files
|   +-- context/                 # Created by Auto-Init
|       +-- STACK.md             # Technology stack
|       +-- ARCHITECTURE.md      # Project architecture
|       +-- CONVENTIONS.md       # Coding conventions
+-- .claude/
|   +-- settings.json            # Permissions + Hooks
|   +-- hooks/
|       +-- protect-files.sh     # Protects .env, package-lock.json, .git/
|       +-- post-edit-lint.sh    # Auto-Lint after Edit
|       +-- circuit-breaker.sh   # Detects edit loops
+-- .github/
|   +-- copilot-instructions.md
+-- CLAUDE.md                    # AI Rules + Critical Rules
```

---

## Security

| Protected | Why |
|-----------|-----|
| `.env` | Secrets |
| `package-lock.json` | Dependency Integrity |
| `.git/` | Repository History |

---

## Skills

### Search and install manually

```bash
npx skills find <technology>
npx skills add <owner/repo@skill> --agent claude-code --agent github-copilot -y
```

### Create custom skills

Skills live in `.claude/skills/<name>/` with a `prompt.md`:

```bash
mkdir -p .claude/skills/my-skill
```

`.claude/skills/my-skill/prompt.md`:
```markdown
# My Skill

Description of what this skill does.

## Rules
- Rule 1
- Rule 2
```

Invoke in Claude Code: `/my-skill`

---

## FAQ

**Where is the project context documentation?**
Auto-Init generates 3 context files in `.agents/context/` (STACK.md, ARCHITECTURE.md, CONVENTIONS.md). These are referenced by CLAUDE.md and copilot-instructions.md.

**Can I regenerate the context files?**
Yes: `.agents/regenerate.sh` — runs Claude Haiku to re-analyze the codebase and update all 3 files.

**Claude CLI vs. Copilot CLI?**
The script automatically detects which AI CLI is installed. Claude gets Auto-Init (context generation + skill curation), Copilot gets manual instructions.

**What about GSD?**
GSD is an optional workflow engine for structured AI development. Install it with `--with-gsd` flag or choose it during interactive setup. See the section below.

---

## Optional: GSD Workflow

[GSD (Get Shit Done)](https://github.com/get-shit-done-cc/get-shit-done-cc) is a workflow engine for structured AI development. It adds phase planning, codebase mapping, session management, and file-based state.

### Install

```bash
# During ai-setup
npx github:onedot-digital-crew/npx-ai-setup --with-gsd

# Or install GSD separately
npx get-shit-done-cc@latest --claude --global
```

### Core Workflow

1. `/gsd:new-project` — Initialize project, tech stack, and roadmap
2. `/gsd:discuss-phase N` — Clarify requirements before planning
3. `/gsd:plan-phase N` — Create step-by-step plan
4. `/gsd:execute-phase N` — Write code & commit atomically
5. `/gsd:verify-work N` — User acceptance testing

### Quick Mode

`/gsd:quick "task"` — Fast fix for isolated, small tasks (CSS, typos, config).

### GSD File Structure (when installed)

```
.planning/                     # GSD State
+-- PROJECT.md                 # Project context
+-- ROADMAP.md                 # Phase structure
+-- STATE.md                   # Project memory
+-- codebase/                  # Created by /gsd:map-codebase
    +-- ARCHITECTURE.md        # Deep architecture analysis
    +-- STRUCTURE.md           # Directory breakdown
    +-- CONVENTIONS.md         # Coding standards
    +-- STACK.md               # Full tech stack
    +-- INTEGRATIONS.md        # External services
    +-- TESTING.md             # Test patterns
    +-- CONCERNS.md            # Tech debt & issues

~/.claude/                     # GSD Global
+-- commands/gsd/              # 29 slash commands
+-- agents/                    # GSD sub-agents
+-- skills/gsd/                # GSD Companion Skill
```

### GSD Cheat Sheet

```
Core Loop:
  /gsd:discuss-phase N      Clarify requirements before planning
  /gsd:plan-phase N         Create step-by-step plan
  /gsd:execute-phase N      Write code & commit atomically
  /gsd:verify-work N        User acceptance testing

Quick Tasks:
  /gsd:quick "task"          Fast fix (typos, CSS, config)
  /gsd:debug                Systematic debugging

Session Management:
  /gsd:pause-work           Save context for later
  /gsd:resume-work          Restore previous session
  /gsd:progress             Status & next action

Roadmap:
  /gsd:add-phase            Add phase to roadmap
  /gsd:insert-phase         Insert urgent work (e.g. 3.1)
  /gsd:add-todo             Capture idea as todo
  /gsd:check-todos          Show open todos
```

---

## Links

- [Skills — Browse & Install](https://skills.sh/)
- [GSD (Get Shit Done)](https://github.com/get-shit-done-cc/get-shit-done-cc)
- [Claude Code Docs](https://docs.anthropic.com/en/docs/claude-code)
- [Claude Code Hooks](https://docs.anthropic.com/en/docs/claude-code/hooks)
- [CLAUDE.md Best Practices](https://docs.anthropic.com/en/docs/claude-code/memory)
